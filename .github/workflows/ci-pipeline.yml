name: CI Pipeline

# Events that trigger the workflow
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # Allows manual trigger from GitHub UI

# Jobs to run
jobs:
  # Job 1: Code Quality Checks (must pass first)
  code-quality:
    name: Code Quality Checks
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements-dev.txt
        
    - name: Run Pylint (Syntax & Style Check)
      run: |
        echo "üîç Running Pylint..."
        pylint src/ --disable=C0114,C0116 || echo "‚ö†Ô∏è Pylint found some issues"
        
    - name: Run Mypy (Type Check)
      run: |
        echo "üîç Running Mypy type checking..."
        mypy src/ --ignore-missing-imports || echo "‚ö†Ô∏è Mypy found some issues"
        
    - name: Run Black (Format Check)
      run: |
        echo "üîç Checking code formatting with Black..."
        black --check src/ || echo "‚ö†Ô∏è Code needs formatting"
        
    - name: Quality checks summary
      run: echo "‚úÖ Code quality checks completed!"

  # Job 2: Run Application (only runs if code-quality succeeds)
  run-application:
    name: Run Hello World Application
    runs-on: ubuntu-latest
    needs: code-quality  # This creates the dependency
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Display Python version
      run: python --version
        
    - name: Run Hello World script
      run: |
        echo "üöÄ Running application..."
        python src/main.py
        echo "‚úÖ Application completed successfully!"
